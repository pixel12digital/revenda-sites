<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Edição Inline</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f3f4f6;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .campo-editavel {
            cursor: pointer !important;
            padding: 4px 8px !important;
            border-radius: 6px !important;
            transition: all 0.2s ease !important;
            display: inline-block !important;
            min-width: 100px !important;
            border: 1px solid transparent !important;
            background-color: transparent !important;
        }
        .campo-editavel:hover {
            background-color: #f3f4f6 !important;
            border-color: #d1d5db !important;
        }
        .campo-editavel.editando {
            background-color: #fff !important;
            border-color: #7c2ae8 !important;
            box-shadow: 0 0 0 2px #ede9fe !important;
            padding: 6px 10px !important;
        }
        .campo-editavel input {
            border: none !important;
            outline: none !important;
            background: transparent !important;
            font-size: inherit !important;
            font-family: inherit !important;
            color: inherit !important;
            width: 100% !important;
            min-width: 200px !important;
            padding: 0 !important;
            margin: 0 !important;
        }
        .campo-editavel input:focus {
            outline: none !important;
        }
        .campo-editavel.salvando {
            opacity: 0.6 !important;
            pointer-events: none !important;
        }
        .campo-editavel.erro {
            border-color: #ef4444 !important;
            background-color: #fef2f2 !important;
        }
        .campo-editavel.sucesso {
            border-color: #22c55e !important;
            background-color: #f0fdf4 !important;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        td {
            padding: 8px;
            border-bottom: 1px solid #eee;
        }
        .label {
            font-weight: bold;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Teste de Edição Inline</h1>
        <p>Clique nos campos para editar. Pressione Enter para salvar ou Escape para cancelar.</p>
        
        <table>
            <tr>
                <td class="label">Nome:</td>
                <td>
                    <span class="campo-editavel" data-campo="nome" data-valor="Charles Dietrich">
                        Charles Dietrich
                    </span>
                </td>
            </tr>
            <tr>
                <td class="label">Email:</td>
                <td>
                    <span class="campo-editavel" data-campo="email" data-valor="charles@example.com">
                        charles@example.com
                    </span>
                </td>
            </tr>
            <tr>
                <td class="label">Telefone:</td>
                <td>
                    <span class="campo-editavel" data-campo="telefone" data-valor="(47) 99999-9999">
                        (47) 99999-9999
                    </span>
                </td>
            </tr>
        </table>
        
        <div style="margin-top: 20px; padding: 10px; background: #f0f0f0; border-radius: 5px;">
            <strong>Log de eventos:</strong>
            <div id="log" style="font-family: monospace; font-size: 12px; margin-top: 10px;"></div>
        </div>
    </div>

    <script>
        function log(message) {
            const logDiv = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            logDiv.innerHTML += `[${time}] ${message}<br>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        // Funcionalidade de edição inline - Versão robusta
        (function() {
            'use strict';
            
            function initEdicaoInline() {
                log('Iniciando edição inline...');
                
                const camposEditaveis = document.querySelectorAll('.campo-editavel');
                log(`Campos editáveis encontrados: ${camposEditaveis.length}`);
                
                camposEditaveis.forEach((campo, index) => {
                    log(`Configurando campo ${index + 1}: ${campo.getAttribute('data-campo')}`);
                    
                    // Remover event listeners anteriores para evitar duplicação
                    campo.removeEventListener('click', handleClick);
                    campo.addEventListener('click', handleClick);
                    
                    function handleClick(e) {
                        log(`Campo clicado: ${campo.getAttribute('data-campo')}`);
                        
                        // Não ativar se já estiver editando
                        if (campo.classList.contains('editando')) {
                            log('Campo já está em edição');
                            return;
                        }
                        
                        e.preventDefault();
                        e.stopPropagation();
                        
                        const valorOriginal = campo.getAttribute('data-valor') || '';
                        const nomeCampo = campo.getAttribute('data-campo');
                        const placeholder = campo.getAttribute('data-placeholder') || '';
                        
                        log(`Valor original: ${valorOriginal}`);
                        log(`Nome do campo: ${nomeCampo}`);
                        
                        // Criar input
                        const input = document.createElement('input');
                        input.type = 'text';
                        input.value = valorOriginal;
                        if (placeholder) input.placeholder = placeholder;
                        
                        // Substituir o conteúdo
                        campo.innerHTML = '';
                        campo.appendChild(input);
                        campo.classList.add('editando');
                        
                        // Focar no input
                        setTimeout(() => {
                            input.focus();
                            input.select();
                        }, 10);
                        
                        // Função para salvar
                        function salvar() {
                            const novoValor = input.value.trim();
                            log(`Salvando valor: ${novoValor}`);
                            
                            // Se não mudou, apenas cancelar
                            if (novoValor === valorOriginal) {
                                log('Valor não mudou, cancelando');
                                cancelar();
                                return;
                            }
                            
                            // Mostrar indicador de salvamento
                            campo.classList.add('salvando');
                            campo.innerHTML = '<span style="color: #7c2ae8;">Salvando...</span>';
                            
                            // Simular salvamento (em vez de enviar para servidor)
                            setTimeout(() => {
                                // Sucesso simulado
                                campo.classList.remove('salvando', 'editando');
                                campo.classList.add('sucesso');
                                campo.innerHTML = novoValor || '—';
                                campo.setAttribute('data-valor', novoValor);
                                
                                log('Salvamento bem-sucedido (simulado)');
                                
                                // Remover classe de sucesso após 2 segundos
                                setTimeout(() => {
                                    campo.classList.remove('sucesso');
                                }, 2000);
                            }, 1000);
                        }
                        
                        // Função para cancelar
                        function cancelar() {
                            log('Cancelando edição');
                            campo.classList.remove('editando');
                            campo.innerHTML = valorOriginal || '—';
                        }
                        
                        // Event listeners
                        input.addEventListener('keydown', function(e) {
                            if (e.key === 'Enter') {
                                e.preventDefault();
                                salvar();
                            } else if (e.key === 'Escape') {
                                e.preventDefault();
                                cancelar();
                            }
                        });
                        
                        input.addEventListener('blur', function() {
                            // Pequeno delay para permitir cliques em botões
                            setTimeout(() => {
                                if (campo.classList.contains('editando')) {
                                    salvar();
                                }
                            }, 100);
                        });
                    }
                });
            }
            
            // Inicializar quando o DOM estiver pronto
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initEdicaoInline);
            } else {
                initEdicaoInline();
            }
            
            // Também inicializar após um pequeno delay para garantir que tudo carregou
            setTimeout(initEdicaoInline, 500);
        })();
    </script>
</body>
</html> 